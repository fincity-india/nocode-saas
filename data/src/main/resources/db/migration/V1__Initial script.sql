/* Creating Database */

-- DROP DATABASE IF EXISTS `data`;

CREATE DATABASE IF NOT EXISTS `data` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

USE `data`;

CREATE TABLE IF NOT EXISTS `data`.`data_connection` (
	ID BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'Primary key',
	CLIENT_CODE CHAR(8) NOT NULL COMMENT 'Client code',
	APP_CODE CHAR(64) NOT NULL COMMENT 'Application code',
	DB_NAME CHAR(64) NOT NULL COMMENT 'Name of the database',
	DB_TYPE ENUM('MYSQL', 'MONGO') NOT NULL DEFAULT ('MYSQL') COMMENT 'Data base type to store the data',
	DB_CONNECTION JSON DEFAULT NULL COMMENT 'JSON connection details',
	DEFAULT_DB TINYINT NOT NULL DEFAULT 0 COMMENT 'Default db connection for all the data',
	CREATED_BY BIGINT UNSIGNED DEFAULT NULL COMMENT 'ID of the user who created this row',
	CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'Time when this row is created',
	UPDATED_BY BIGINT UNSIGNED DEFAULT NULL COMMENT 'ID of the user who updated this row',
	UPDATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'Time when this row is updated',
	PRIMARY KEY (ID),
	UNIQUE KEY UK1_DATA_CONN (CLIENT_CODE, APP_CODE, DB_NAME),
)
ENGINE = INNODB
CHARACTER SET utf8mb4
COLLATE utf8mb4_unicode_ci;

CREATE TABLE IF NOT EXISTS `data`.`data_storage` (
	ID BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'Primary key',
	CLIENT_CODE CHAR(8) NOT NULL COMMENT 'Client code',
	APP_CODE CHAR(64) NOT NULL COMMENT 'Application code',
	NAMESPACE CHAR(64) NOT NULL COMMENT 'Namespace',
	NAME CHAR(32) NOT NULL COMMENT 'Name',
	DB_NAME CHAR(64) DEFAULT NULL COMMENT 'Database name where the data is stored',
	CREATED_BY BIGINT UNSIGNED DEFAULT NULL COMMENT 'ID of the user who created this row',
	CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'Time when this row is created',
	UPDATED_BY BIGINT UNSIGNED DEFAULT NULL COMMENT 'ID of the user who updated this row',
	UPDATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'Time when this row is updated',
	PRIMARY KEY (ID),
	UNIQUE KEY UK1_DATA_STORAGE (CLIENT_CODE, APP_CODE, NAMESPACE, NAME)
)
ENGINE = INNODB
CHARACTER SET utf8mb4
COLLATE utf8mb4_unicode_ci;

CREATE TABLE IF NOT EXISTS `data`.`data_storage_field` (
	ID BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'Primary key',
	NAME CHAR(64) NOT NULL COMMENT 'Name of the field',
	TYPE ENUM('INTEGER', 'LONG', 'FLOAT', 'DOUBLE', 'STRING', 'OBJECT', 'ARRAY', 'BOOLEAN') NOT NULL COMMENT 'Data type of the field',
	SIZE SMALLINT UNSIGNED DEFAULT NULL,
	STORAGE_ID BIGINT UNSIGNED NOT NULL COMMENT 'Storage id to which this field belong',
	CREATED_BY BIGINT UNSIGNED DEFAULT NULL COMMENT 'ID of the user who created this row',
	CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'Time when this row is created',
	UPDATED_BY BIGINT UNSIGNED DEFAULT NULL COMMENT 'ID of the user who updated this row',
	UPDATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'Time when this row is updated',
	PRIMARY KEY (ID),
	UNIQUE KEY UK1_DATA_STORAGED (CLIENT_CODE, APP_CODE, NAMESPACE, NAME),
	CONSTRAINT FK1_STORAGE_CONN_ID FOREIGN KEY (STORAGE_ID) REFERENCES data_storage (ID) ON DELETE RESTRICT ON UPDATE RESTRICT
)
ENGINE = INNODB
CHARACTER SET utf8mb4
COLLATE utf8mb4_unicode_ci;

CREATE TABLE IF NOT EXISTS `data`.`data_storage_activity` (
	ID BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'Primary key',
	STORAGE_ID BIGINT UNSIGNED NOT NULL COMMENT 'Storage id to which this field belong',
	OPERATION TEXT DEFAULT 'NOOP' COMMENT 'The operation to be done on the database',
	CREATED_BY BIGINT UNSIGNED DEFAULT NULL COMMENT 'ID of the user who created this row',
	CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'Time when this row is created',
	UPDATED_BY BIGINT UNSIGNED DEFAULT NULL COMMENT 'ID of the user who updated this row',
	UPDATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'Time when this row is updated',
	PRIMARY KEY (ID),
	UNIQUE KEY UK1_DATA_STORAGED (CLIENT_CODE, APP_CODE, NAMESPACE, NAME),
)
ENGINE = INNODB
CHARACTER SET utf8mb4
COLLATE utf8mb4_unicode_ci;

CREATE TABLE IF NOT EXISTS `data`.`data_client_activity` (
	ID BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'Primary key',
	STORAGE_ID BIGINT UNSIGNED NOT NULL COMMENT 'Storage id to which this field belong',
	CLIENT_CODE CHAR(8) NOT NULL COMMENT 'Client code',
	ACTIVITY_ID BIGINT UNSIGNED NOT NULL COMMENT 'Activity ID applied',
	STATUS ENUM ('ERROR','COMPLETED') NOT NULL DEFAULT VALUE 'ERROR' COMMENT 'Status of the activity',
	ERROR TEXT DEFAULT NULL COMMENT 'Error message while perfom',
	CREATED_BY BIGINT UNSIGNED DEFAULT NULL COMMENT 'ID of the user who created this row',
	CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'Time when this row is created',
	UPDATED_BY BIGINT UNSIGNED DEFAULT NULL COMMENT 'ID of the user who updated this row',
	UPDATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'Time when this row is updated',
	PRIMARY KEY (ID),
	UNIQUE KEY UK1_DATA_STORAGED (CLIENT_CODE, APP_CODE, NAMESPACE, NAME),
)
ENGINE = INNODB
CHARACTER SET utf8mb4
COLLATE utf8mb4_unicode_ci;




